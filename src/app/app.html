<!-- ApplyTrack Dashboard using Angular Material Components -->
<mat-toolbar color="primary">
  <div class="toolbar-left">
    <span class="app-title">{{ title() }}</span>
    <span class="app-subtitle">Manage your job applications efficiently</span>
  </div>
  <span class="example-spacer"></span>
  <button class="add-application-btn" (click)="openAddApplicationDialog()">
    <mat-icon>add</mat-icon>
    Add Application
  </button>
</mat-toolbar>

<div class="dashboard-container">
  <!-- Statistics Cards -->
  <div class="stats-container">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().total }}</div>
        <div class="stat-label">Total Applications</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().applied }}</div>
        <div class="stat-label">Applied</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().interviews }}</div>
        <div class="stat-label">Interviews</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().offers }}</div>
        <div class="stat-label">Offers</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().successRate }}%</div>
        <div class="stat-label">Success Rate</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-container">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search by company or position...</mat-label>
      <input
        matInput
        [value]="searchTerm()"
        (input)="onSearchChange($any($event.target).value || '')"
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>All Statuses</mat-label>
      <mat-select [value]="selectedStatus()" (valueChange)="onStatusChange($event)">
        <mat-option value="all">All Statuses</mat-option>
        <mat-option value="applied">Applied</mat-option>
        <mat-option value="interview">Interview</mat-option>
        <mat-option value="offer">Offer</mat-option>
        <mat-option value="rejected">Rejected</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Upcoming Reminders Section -->
  <div class="reminders-section">
    <h2>Upcoming Reminders</h2>

    @if (overdueReminders().length === 0 && upcomingReminders().length === 0) {
    <div class="no-reminders">
      <mat-icon>check_circle</mat-icon>
      <p>No upcoming reminders. You're all caught up!</p>
    </div>
    } @else {
    <!-- Overdue Reminders -->
    @if (overdueReminders().length > 0) {
    <div class="overdue-section">
      <h3 class="overdue-title">
        <mat-icon>warning</mat-icon>
        Overdue ({{ overdueReminders().length }})
      </h3>
      <div class="reminders-list">
        @for (reminder of overdueReminders(); track reminder.applicationId) {
        <mat-card class="reminder-card overdue">
          <mat-card-content>
            <div class="reminder-header">
              <div class="reminder-info">
                <mat-icon class="reminder-icon">{{ getReminderIcon(reminder.type) }}</mat-icon>
                <div class="reminder-details">
                  <h4>{{ reminder.company }} - {{ reminder.position }}</h4>
                  <p class="reminder-description">{{ reminder.description }}</p>
                </div>
              </div>
              <div class="reminder-actions">
                <div class="reminder-date">
                  <small>{{ reminder.date | date : 'MMM d, y' }}</small>
                  <small class="reminder-time">{{ reminder.date | date : 'shortTime' }}</small>
                  <span class="overdue-text">{{ getReminderDateText(reminder) }}</span>
                </div>
                <button
                  mat-icon-button
                  color="primary"
                  (click)="markReminderComplete(reminder.applicationId)"
                  aria-label="Mark as complete"
                >
                  <mat-icon>check</mat-icon>
                </button>
              </div>
            </div>
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>
    }

    <!-- Upcoming Reminders -->
    @if (upcomingReminders().length > 0) {
    <div class="upcoming-section">
      @if (overdueReminders().length > 0) {
      <h3 class="upcoming-title">Upcoming ({{ upcomingReminders().length }})</h3>
      }
      <div class="reminders-list">
        @for (reminder of upcomingReminders(); track reminder.applicationId) {
        <mat-card class="reminder-card" [class]="getReminderUrgencyClass(reminder)">
          <mat-card-content>
            <div class="reminder-header">
              <div class="reminder-info">
                <mat-icon class="reminder-icon">{{ getReminderIcon(reminder.type) }}</mat-icon>
                <div class="reminder-details">
                  <h4>{{ reminder.company }} - {{ reminder.position }}</h4>
                  <p class="reminder-description">{{ reminder.description }}</p>
                </div>
              </div>
              <div class="reminder-actions">
                <div class="reminder-date">
                  <small>{{ reminder.date | date : 'MMM d, y' }}</small>
                  <small class="reminder-time">{{ reminder.date | date : 'shortTime' }}</small>
                  <span class="urgency-text">{{ getReminderDateText(reminder) }}</span>
                </div>
                <button
                  mat-icon-button
                  color="primary"
                  (click)="markReminderComplete(reminder.applicationId)"
                  aria-label="Mark as complete"
                >
                  <mat-icon>check</mat-icon>
                </button>
              </div>
            </div>
            @if (isReminderUrgent(reminder) && !reminder.isOverdue) {
            <div class="urgent-badge">
              <mat-icon>priority_high</mat-icon>
              <span>Urgent</span>
            </div>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>
    } }
  </div>

  <!-- Status Columns -->
  <div class="status-columns-container">
    <!-- Applied Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Applied</span>
        <mat-chip>{{ filteredAppliedApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #appliedList="cdkDropList"
        id="applied-list"
        [cdkDropListData]="filteredAppliedApplications()"
        [cdkDropListConnectedTo]="[interviewList, offerList, rejectedList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of filteredAppliedApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag (click)="editApplication(app, $event)">
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>

    <!-- Interview Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Interview</span>
        <mat-chip>{{ filteredInterviewApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #interviewList="cdkDropList"
        id="interview-list"
        [cdkDropListData]="filteredInterviewApplications()"
        [cdkDropListConnectedTo]="[appliedList, offerList, rejectedList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of filteredInterviewApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag (click)="editApplication(app, $event)">
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>

    <!-- Offer Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Offer</span>
        <mat-chip>{{ filteredOfferApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #offerList="cdkDropList"
        id="offer-list"
        [cdkDropListData]="filteredOfferApplications()"
        [cdkDropListConnectedTo]="[appliedList, interviewList, rejectedList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of filteredOfferApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag (click)="editApplication(app, $event)">
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>

    <!-- Rejected Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Rejected</span>
        <mat-chip>{{ filteredRejectedApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #rejectedList="cdkDropList"
        id="rejected-list"
        [cdkDropListData]="filteredRejectedApplications()"
        [cdkDropListConnectedTo]="[appliedList, interviewList, offerList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of filteredRejectedApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag (click)="editApplication(app, $event)">
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>
  </div>
</div>
<router-outlet />
