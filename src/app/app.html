<!-- ApplyTrack Dashboard using Angular Material Components -->
<mat-toolbar color="primary">
  <div class="toolbar-left">
    <span class="app-title">{{ title() }}</span>
    <span class="app-subtitle">Manage your job applications efficiently</span>
  </div>
  <span class="example-spacer"></span>
  <button mat-raised-button color="accent" class="add-application-btn">
    <mat-icon>add</mat-icon>
    Add Application
  </button>
</mat-toolbar>

<div class="dashboard-container">
  <!-- Statistics Cards -->
  <div class="stats-container">
    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().total }}</div>
        <div class="stat-label">Total Applications</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().applied }}</div>
        <div class="stat-label">Applied</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().interviews }}</div>
        <div class="stat-label">Interviews</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().offers }}</div>
        <div class="stat-label">Offers</div>
      </mat-card-content>
    </mat-card>

    <mat-card class="stat-card">
      <mat-card-content>
        <div class="stat-value">{{ stats().successRate }}%</div>
        <div class="stat-label">Success Rate</div>
      </mat-card-content>
    </mat-card>
  </div>

  <!-- Search and Filter Section -->
  <div class="search-filter-container">
    <mat-form-field appearance="outline" class="search-field">
      <mat-label>Search by company or position...</mat-label>
      <input
        matInput
        [value]="searchTerm()"
        (input)="searchTerm.set($any($event.target).value || '')"
      />
      <mat-icon matSuffix>search</mat-icon>
    </mat-form-field>

    <mat-form-field appearance="outline" class="filter-field">
      <mat-label>All Statuses</mat-label>
      <mat-select [value]="selectedStatus()" (valueChange)="selectedStatus.set($event)">
        <mat-option value="all">All Statuses</mat-option>
        <mat-option value="applied">Applied</mat-option>
        <mat-option value="interview">Interview</mat-option>
        <mat-option value="offer">Offer</mat-option>
        <mat-option value="rejected">Rejected</mat-option>
      </mat-select>
    </mat-form-field>
  </div>

  <!-- Upcoming Reminders Section -->
  <div class="reminders-section">
    <h2>Upcoming Reminders</h2>

    @if (upcomingReminders().length === 0) {
    <div class="no-reminders">
      <mat-icon>check_circle</mat-icon>
      <p>No upcoming reminders. You're all caught up!</p>
    </div>
    } @else {
    <div class="reminders-list">
      @for (reminder of upcomingReminders(); track reminder.id) {
      <mat-card class="reminder-card" [class.urgent]="isReminderUrgent(reminder.date)">
        <mat-card-content>
          <div class="reminder-header">
            <div class="reminder-info">
              <mat-icon class="reminder-icon">{{ getReminderIcon(reminder.type) }}</mat-icon>
              <div class="reminder-details">
                <h4>{{ reminder.company }} - {{ reminder.position }}</h4>
                <p class="reminder-description">{{ reminder.description }}</p>
              </div>
            </div>
            <div class="reminder-actions">
              <div class="reminder-date">
                <small>{{ reminder.date | date : 'MMM d, y' }}</small>
                <small class="reminder-time">{{ reminder.date | date : 'shortTime' }}</small>
              </div>
              <button
                mat-icon-button
                color="primary"
                (click)="markReminderComplete(reminder.id)"
                aria-label="Mark as complete"
              >
                <mat-icon>check</mat-icon>
              </button>
            </div>
          </div>
          @if (isReminderUrgent(reminder.date)) {
          <div class="urgent-badge">
            <mat-icon>priority_high</mat-icon>
            <span>Urgent</span>
          </div>
          }
        </mat-card-content>
      </mat-card>
      }
    </div>
    }
  </div>

  <!-- Status Columns -->
  <div class="status-columns-container">
    <!-- Applied Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Applied</span>
        <mat-chip>{{ appliedApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #appliedList="cdkDropList"
        id="applied-list"
        [cdkDropListData]="appliedApplications()"
        [cdkDropListConnectedTo]="[interviewList, offerList, rejectedList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of appliedApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag>
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>

    <!-- Interview Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Interview</span>
        <mat-chip>{{ interviewApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #interviewList="cdkDropList"
        id="interview-list"
        [cdkDropListData]="interviewApplications()"
        [cdkDropListConnectedTo]="[appliedList, offerList, rejectedList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of interviewApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag>
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>

    <!-- Offer Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Offer</span>
        <mat-chip>{{ offerApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #offerList="cdkDropList"
        id="offer-list"
        [cdkDropListData]="offerApplications()"
        [cdkDropListConnectedTo]="[appliedList, interviewList, rejectedList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of offerApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag>
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>

    <!-- Rejected Column -->
    <div class="status-column">
      <div class="column-header">
        <span>Rejected</span>
        <mat-chip>{{ rejectedApplications().length }}</mat-chip>
      </div>
      <div
        cdkDropList
        #rejectedList="cdkDropList"
        id="rejected-list"
        [cdkDropListData]="rejectedApplications()"
        [cdkDropListConnectedTo]="[appliedList, interviewList, offerList]"
        class="column-content"
        (cdkDropListDropped)="drop($event)"
      >
        @for (app of rejectedApplications(); track app.id) {
        <mat-card class="application-card" cdkDrag>
          <mat-card-header>
            <mat-card-title>{{ app.company }}</mat-card-title>
            <mat-card-subtitle>{{ app.position }}</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <p>
              <small>Applied: {{ app.dateApplied | date : 'shortDate' }}</small>
            </p>
            @if (app.notes) {
            <p>
              <small>{{ app.notes }}</small>
            </p>
            }
          </mat-card-content>
        </mat-card>
        }
      </div>
    </div>
  </div>
</div>
<router-outlet />
